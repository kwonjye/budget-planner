<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jye.budget.mapper.AssetMapper">
    <sql id="asset">
        SELECT asset_id,
               user_id,
               asset_name,
               initial_amount,
               current_amount,
               is_allocated,
               created_at,
               updated_at
        FROM asset
    </sql>
    <select id="findByUserId" resultType="jye.budget.entity.Asset">
        <include refid="asset"/>
        WHERE user_id = #{userId}
    </select>
    <insert id="save" useGeneratedKeys="true" keyColumn="asset_id" keyProperty="assetId">
        INSERT INTO asset (
                           user_id,
                           asset_name,
                           initial_amount,
                           current_amount,
                           is_allocated,
                           created_at,
                           updated_at
        ) VALUES (
                  #{userId},
                  #{assetName},
                  #{initialAmount},
                  #{currentAmount},
                  #{isAllocated},
                  NOW(),
                  NOW()
                         )
    </insert>
    <select id="existsByAssetName" resultType="boolean">
        SELECT EXISTS(
            SELECT 1
            FROM asset
            WHERE user_id = #{userId} AND asset_name = #{assetName}
            <if test="assetId != null">
                AND asset_id != #{assetId}
            </if>
        )
    </select>
    <select id="findById" resultType="jye.budget.entity.Asset">
        <include refid="asset"/>
        WHERE asset_id = #{assetId}
    </select>
    <update id="update">
        UPDATE asset
        SET asset_name = #{assetName},
            initial_amount = #{initialAmount},
            current_amount = #{currentAmount},
            is_allocated = #{isAllocated},
            updated_at = NOW()
        WHERE asset_id = #{assetId}
    </update>
    <delete id="delete">
        DELETE FROM asset
        WHERE asset_id = #{assetId}
    </delete>
</mapper>